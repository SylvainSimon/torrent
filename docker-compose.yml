services:
    gluetun:
        image: qmcgaw/gluetun:v3
        container_name: gluetun
        cap_add:
            - NET_ADMIN
        devices:
            - /dev/net/tun:/dev/net/tun
        ports:
            - 8080:8080
        volumes:
            - ./gluetun:/gluetun
            - /tmp/gluetun:/tmp/gluetun # Volume partagÃ© pour le fichier de port
        environment:
            - VPN_SERVICE_PROVIDER=protonvpn
            - VPN_TYPE=wireguard
            - WIREGUARD_PRIVATE_KEY=EBK3yvEOMgCmZ5e+sLfiUoKqm4udHGCWXI7BbiFST3E=
            - VPN_PORT_FORWARDING=on
            - VPN_PORT_FORWARDING_UP_COMMAND=/bin/sh -c 'wget -O- --retry-connrefused --post-data "json={\"listen_port\":{{PORTS}}}" http://127.0.0.1:8080/api/v2/app/setPreferences 2>&1'
            - TZ=Europe/Paris
        restart: always

    qbittorrent:
        image: lscr.io/linuxserver/qbittorrent:latest
        container_name: qbittorrent
        environment:
            - PUID=1000 # UID de seeduser
            - PGID=1000 # GID de seeduser
            - TZ=Europe/Paris
            - WEBUI_PORT=8080
        volumes:
            - ./qbittorrent/config:/config
            - ./downloads:/downloads
            - /tmp/gluetun:/tmp/gluetun
        network_mode: "service:gluetun"
        depends_on:
            gluetun:
                condition: service_healthy
        restart: always
